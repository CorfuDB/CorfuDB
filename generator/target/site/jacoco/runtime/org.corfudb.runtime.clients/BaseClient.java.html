<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>BaseClient.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">generator</a> &gt; <a href="../index.html" class="el_bundle">runtime</a> &gt; <a href="index.source.html" class="el_package">org.corfudb.runtime.clients</a> &gt; <span class="el_source">BaseClient.java</span></div><h1>BaseClient.java</h1><pre class="source lang-java linenums">package org.corfudb.runtime.clients;

import java.util.concurrent.CompletableFuture;

import lombok.Getter;
import lombok.Setter;
import lombok.extern.slf4j.Slf4j;

import org.corfudb.protocols.wireprotocol.CorfuMsg;
import org.corfudb.protocols.wireprotocol.CorfuMsgType;
import org.corfudb.protocols.wireprotocol.CorfuPayloadMsg;
import org.corfudb.protocols.wireprotocol.VersionInfo;

/**
 * This is a base client which sends basic messages.
 * It mainly sends PINGs, as well as the ACK/NACKs defined by
 * the Corfu protocol.
 * This is also responsible to send SEAL messages used to seal the servers with an epoch
 *
 * &lt;p&gt;Created by mwei on 12/9/15.
 */
<span class="nc" id="L22">@Slf4j</span>
public class BaseClient implements IClient {

    /**
     * The router to use for the client.
     */
<span class="nc" id="L28">    @Getter</span>
<span class="nc" id="L29">    @Setter</span>
    private IClientRouter router;

    private final long epoch;

<span class="nc" id="L34">    public BaseClient(IClientRouter router, long epoch) {</span>
<span class="nc" id="L35">        this.router = router;</span>
<span class="nc" id="L36">        this.epoch = epoch;</span>
<span class="nc" id="L37">    }</span>

    /**
     * Ping the endpoint, synchronously.
     * Note: this ping is epoch aware
     *
     * @return True, if the endpoint was reachable, false otherwise.
     */
    public boolean pingSync() {
        try {
<span class="nc" id="L47">            return ping().get();</span>
<span class="nc" id="L48">        } catch (Exception e) {</span>
<span class="nc" id="L49">            log.error(&quot;Ping failed due to exception&quot;, e);</span>
<span class="nc" id="L50">            return false;</span>
        }
    }

    /**
     * Sets the epoch on client router and on the target layout server.
     *
     * @param newEpoch New Epoch to be set
     * @return Completable future which returns true on successful epoch set.
     */
    public CompletableFuture&lt;Boolean&gt; sealRemoteServer(long newEpoch) {
<span class="nc" id="L61">        CorfuMsg msg = new CorfuPayloadMsg&lt;&gt;(CorfuMsgType.SEAL, newEpoch).setEpoch(epoch);</span>
<span class="nc" id="L62">        log.info(&quot;sealRemoteServer: send SEAL from me(clientId={}) to new epoch {}&quot;,</span>
<span class="nc" id="L63">                msg.getClientID(), epoch);</span>
<span class="nc" id="L64">        return router.sendMessageAndGetCompletable(msg);</span>
    }

    public CompletableFuture&lt;VersionInfo&gt; getVersionInfo() {
<span class="nc" id="L68">        return router.sendMessageAndGetCompletable(</span>
<span class="nc" id="L69">                new CorfuMsg(CorfuMsgType.VERSION_REQUEST).setEpoch(epoch));</span>
    }


    /**
     * Ping the endpoint, asynchronously.
     *
     * @return A completable future which will be completed with True if
     * the endpoint is reachable, otherwise False or exceptional completion.
     */
    public CompletableFuture&lt;Boolean&gt; ping() {
<span class="nc" id="L80">        return router.sendMessageAndGetCompletable(</span>
<span class="nc" id="L81">                new CorfuMsg(CorfuMsgType.PING).setEpoch(epoch));</span>
    }

    /**
     * Reset the endpoint, asynchronously.
     * WARNING: ALL EXISTING DATA ON THIS NODE WILL BE LOST.
     *
     * @return A completable future which will be completed with True if
     * the endpoint acks, otherwise False or exceptional completion.
     */
    public CompletableFuture&lt;Boolean&gt; reset() {
<span class="nc" id="L92">        return router.sendMessageAndGetCompletable(new CorfuMsg(CorfuMsgType.RESET)</span>
<span class="nc" id="L93">                .setEpoch(epoch));</span>
    }

    /**
     * Restart the endpoint, asynchronously.
     *
     * @return A completable future which will be completed with True if
     * the endpoint acks, otherwise False or exceptional completion.
     */
    public CompletableFuture&lt;Boolean&gt; restart() {
<span class="nc" id="L103">        return router.sendMessageAndGetCompletable(new CorfuMsg(CorfuMsgType.RESTART)</span>
<span class="nc" id="L104">                .setEpoch(epoch));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>