syntax = "proto3";

package org.corfudb.runtime;
option java_package = "org.corfudb.runtime";

import "rpc_common.proto";
import "corfu_store_metadata.proto";

/**
 * Protobuf definition for Corfu Compactor.
 */

message CheckpointingStatus {
  enum StatusType {
    IDLE = 0;
    STARTED = 1;
    COMPLETED = 3;
    FAILED = 4;
  }
  StatusType status = 1;
  string client_name = 2;
  int64 table_size = 3;
  int64 time_taken = 4;
  int64 cycle_count = 5;
}

message StringKey {
  string key = 1;
}

message ActiveCPStreamMsg {
  int64 sync_heartbeat = 1;
}

/**
 * Key for the CompactionCycleHistory table.
 * Uses cycle_count as the unique identifier for each compaction cycle.
 */
message CompactionCycleKey {
  int64 cycle_count = 1;
}

/**
 * Lightweight value for the CompactionCycleHistory table.
 * Stores only essential information about each completed compaction cycle.
 * Detailed per-table information can be found in logs.
 */
message CompactionCycleHistory {
  int64 cycle_count = 1;
  CheckpointingStatus.StatusType status = 2;  // COMPLETED or FAILED
  int64 start_time_ms = 3;
  int64 end_time_ms = 4;
}
